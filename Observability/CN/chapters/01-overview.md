# **Observability: An Overview**

**“Observability”**（可观测性）是系统工程中的一个核心概念，尤其在分布式系统、云原生架构和微服务环境中至关重要。Observability 指的是通过系统外部可见的数据（如指标、日志、追踪信息等），推断系统内部状态并理解其运行行为的能力。它能够帮助工程师快速定位问题，优化性能，确保系统的可靠性和稳定性。

---

## **核心组成：从三大支柱到五大关键数据类型**

传统上，Observability 的三大支柱是 **Metrics**（指标）、**Logs**（日志）和 **Traces**（分布式追踪）。在现代 Observability 中，这一体系已扩展为五大数据类型，涵盖 **Events**（事件）和 **Profiles**（性能剖析）。

### **1. Metrics（指标）**
- **定义**：定量的时间序列数据，用于描述系统的性能和资源利用率。
- **用途**：趋势分析、容量规划、实时健康监控。
- **典型内容**：
  - CPU 使用率、内存占用、磁盘 I/O、网络流量。
  - 应用层指标（如请求数、响应时间、错误率）。
- **工具**：
  - Prometheus、Grafana、Datadog、CloudWatch。

### **2. Logs（日志）**
- **定义**：系统运行时的记录信息，通常以文本形式存储。
- **用途**：问题排查和故障根因分析。
- **典型内容**：
  - 错误日志、访问日志、调试信息。
- **工具**：
  - Elasticsearch、Fluentd、Splunk。

### **3. Traces（分布式追踪）**
- **定义**：记录请求在分布式系统中跨多个服务或组件的传播路径。
- **用途**：分析请求性能瓶颈、延迟和依赖关系。
- **典型内容**：
  - 请求 ID、服务调用耗时、失败服务节点。
- **工具**：
  - OpenTelemetry、Jaeger、Zipkin。

### **4. Events（事件）**
- **定义**：系统中发生的重要状态变化或操作记录。
- **用途**：补充 Metrics 和 Logs，为关键操作提供上下文。
- **典型事件**：
  - Kubernetes Pod 生命周期变化（启动、销毁）。
  - 配置变更、用户行为（如点击、登录）。
- **工具**：
  - Kubernetes Events、EventBridge。

### **5. Profiles（性能剖析）**
- **定义**：动态收集程序运行时的性能数据，揭示代码和资源的使用情况。
- **用途**：优化性能、识别瓶颈。
- **典型内容**：
  - CPU/内存使用热点图。
  - 函数调用栈及耗时分布。
- **工具**：
  - Pyroscope、Parca、Flame Graph。

---

## **CBPF/eBPF 与零代码开源 Agent 技术**

现代 Observability 的实现得益于 **CBPF/eBPF** 技术，它们支持高性能、零代码的数据采集，并已催生出多种开源 Agent 工具。

### **CBPF 与 eBPF 技术概述**
- **CBPF**：
  - **经典 BPF**，主要用于简单的网络数据包过滤操作，如 `tcpdump`。
  - 功能有限，仅支持基础网络流量分析。
- **eBPF**：
  - **扩展版 BPF**，支持复杂逻辑，可动态挂载到内核钩子点，执行安全沙箱程序。
  - 用于网络监控、性能分析和安全观测。
  - 优势：高性能、灵活性强、无需修改应用代码。

### **零代码开源 Agent**
利用 eBPF 的强大能力，社区开发了多种开源工具，能够实现零代码的深度数据采集。

#### **1. DeepFlow-Agent**
- **特点**：
  - 利用 eBPF 和 XDP 技术，从内核采集网络流量、应用性能数据和容器信息。
  - 自动化关联 Kubernetes 元数据，生成服务依赖关系和网络拓扑。
  - 高性能、无侵入式，适合云原生环境。
- **功能**：
  - 数据流日志（Flow Logs）。
  - 应用性能指标（APM 数据）。
  - 容器、Pod、虚拟机的元数据采集。
- **应用场景**：
  - 网络观测、分布式应用监控、安全分析。
- **官网**：<https://deepflow.yunshan.net/>

#### **2. Pixie**
- **特点**：
  - 基于 eBPF 的全自动化 Kubernetes Observability 工具。
  - 无需代码修改，实时捕获请求延迟、应用状态和错误信息。
- **功能**：
  - 分布式追踪和服务依赖图。
  - 实时应用性能剖析。
- **应用场景**：
  - Kubernetes 环境的快速问题排查和性能优化。
- **官网**：<https://pixielabs.ai/>

#### **3. Cilium**
- **特点**：
  - 使用 eBPF 提供高效的网络和安全 Observability 功能。
  - 与 Kubernetes 深度集成，支持服务网格。
- **功能**：
  - 网络流量监控。
  - API 请求分析和服务依赖追踪。
- **应用场景**：
  - 云原生网络安全和 Observability。
- **官网**：<https://cilium.io/>

#### **4. Parca**
- **特点**：
  - 专注于性能剖析，基于 eBPF 的开源工具。
  - 无侵入式采集运行时的 CPU 和内存使用数据。
- **功能**：
  - 生成火焰图分析性能瓶颈。
- **应用场景**：
  - 微服务和云原生环境的性能优化。
- **官网**：<https://parca.dev/>

#### **5. Sysdig**
- **特点**：
  - eBPF 驱动的安全和监控工具。
  - 采集系统调用和网络流量，用于安全分析和性能监控。
- **功能**：
  - 深入的系统调用审计。
  - 容器和 Kubernetes 的运行时安全监控。
- **应用场景**：
  - 安全观测与性能监控结合。
- **官网**：<https://sysdig.com/>

---

## **关键术语**
| **术语**             | **定义**                                                   |
|----------------------|-----------------------------------------------------------|
| **Monitoring**       | 实时监控系统的健康状况和性能，用于快速检测异常。              |
| **Tracing**          | 追踪请求在分布式系统中的传播路径，用于依赖关系和性能分析。      |
| **Logging**          | 捕获系统运行时的信息，记录详细的事件历史。                    |
| **Instrumentation**  | 在代码中嵌入可观测性相关逻辑以生成数据，便于调试和监控。        |
| **CBPF**             | 经典 BPF，主要用于简单的网络数据包过滤操作。                   |
| **eBPF**             | 扩展 BPF，可挂载到内核多个钩子点，支持复杂的监控和分析任务。     |
| **XDP**              | 高性能网络数据包处理框架，运行在网络驱动层。                   |

---

## **总结**
Observability 是现代分布式系统中不可或缺的能力。通过 Metrics、Logs、Traces、Events 和 Profiles 的结合，以及 CBPF/eBPF、XDP 等强大的内核技术支持，我们能够全面了解系统的行为和状态，并快速诊断问题。结合 DeepFlow-Agent、Pixie、Cilium 等开源工具，可以轻松实现零代码、低开销的高效数据采集，保障系统的稳定性和性能。

